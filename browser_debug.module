<?php
/**
 * @file
 * Debugs session and logs to JavaScript console.
 *
 * To configure log files run the following command from root of Drupal site
 * amending log file paths as appropriate:
 * drush vset browser_debug_logs "/var/log/one.log,/var/log/two.log"
 */

include_once '/usr/local/include/composer/vendor/autoload.php';

/**
 * Implements hook_boot().
 *
 * Gather log positions.
 */
function browser_debug_boot() {
  require_once 'BrowserDebug.php';
  $browser_debug = &drupal_static('browser_debug');
  if (!isset($browser_debug)) {
    $browser_debug = new BrowserDebug();
  }
}

/**
 * Implements hook_ajax_render_alter().
 *
 * Add our own completion command to trigger client side actions.
 */
function browser_debug_ajax_render_alter(&$commands) {
  $browser_debug = &drupal_static('browser_debug');
  $commands[] = array('command' => 'browserDebugAjaxComplete', 'arguments' => $browser_debug->getAllData());
}

/**
 * Implements hook_js_alter().
 *
 * Populate client side data in Drupal.settings.
 */
function browser_debug_js_alter() {
  static $done = FALSE;
  if(!$done) {
    if(current_path() !== 'system/ajax') {
      $done = TRUE;
      $browser_debug = &drupal_static('browser_debug');
      $data = $browser_debug->getAllData();
      drupal_add_js(array('browserDebug' => $data), 'setting');
    } 
  }
}

/**
 * Dump a variable.
 *
 * @param mixed $var
 *   Variable to dump.
 */
function d($var) {
  $browser_debug = &drupal_static('browser_debug');
  $browser_debug->dump($var);
}



